<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hall Availability</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #calendar-container { max-width: 800px; margin: 0 auto; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: #f3f4f6; border-bottom: 1px solid #ddd; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .day-header { padding: 10px; text-align: center; font-weight: bold; background: #f9fafb; border-bottom: 1px solid #eee; }
        .day-cell { min-height: 80px; padding: 5px; border-right: 1px solid #eee; border-bottom: 1px solid #eee; position: relative; }
        .day-cell:nth-child(7n) { border-right: none; }
        .event-dot { display: block; margin-top: 2px; padding: 2px 4px; border-radius: 3px; font-size: 10px; color: white; }
        .status-booked { background-color: #10B981; } /* Green */
        .status-blocked { background-color: #EF4444; } /* Red */
    </style>
</head>
<body>

    <h2 style="text-align: center;">Hall Availability</h2>
    
    <!-- Widget Container -->
    <div id="calendar-container">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">Prev</button>
            <span id="month-label">Month Year</span>
            <button onclick="changeMonth(1)">Next</button>
        </div>
        <div id="calendar-grid" class="calendar-grid">
            <!-- Grid generated by JS -->
        </div>
    </div>

    <script>
        // CONFIGURATION
        const API_URL = 'http://localhost:8000/api/public/calendar/1'; // Replace 1 with Center ID

        let currentDate = new Date();
        let events = [];

        async function fetchEvents() {
            try {
                // Fetch for current month range
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const start = new Date(year, month, 1).toLocaleDateString('en-CA');
                const end = new Date(year, month + 1, 0).toLocaleDateString('en-CA');

                const response = await fetch(`${API_URL}?start_date=${start}&end_date=${end}`);
                events = await response.json();
                renderCalendar();
            } catch (error) {
                console.error("Error loading events:", error);
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthLabel = document.getElementById('month-label');
            grid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            monthLabel.textContent = `${monthNames[month]} ${year}`;

            // Headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const div = document.createElement('div');
                div.className = 'day-header';
                div.textContent = day;
                grid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Empty slots
            for (let i = 0; i < firstDay; i++) {
                const div = document.createElement('div');
                div.className = 'day-cell';
                div.style.backgroundColor = '#f9fafb';
                grid.appendChild(div);
            }

            // Days
            for (let i = 1; i <= daysInMonth; i++) {
                const div = document.createElement('div');
                div.className = 'day-cell';
                
                // Date Number
                const num = document.createElement('div');
                num.textContent = i;
                num.style.fontWeight = 'bold';
                num.style.fontSize = '12px';
                num.style.color = '#666';
                div.appendChild(num);

                // Find Events
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const dayEvents = events.filter(e => e.event_date === dateStr);

                dayEvents.forEach(ev => {
                    const badge = document.createElement('div');
                    badge.className = `event-dot status-${ev.status}`;
                    badge.textContent = ev.status === 'booked' ? 'Booked' : 'Blocked';
                    div.appendChild(badge);
                });

                grid.appendChild(div);
            }
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            fetchEvents();
        }

        // Init
        fetchEvents();
    </script>

</body>
</html>
